ARG VERSION=1.0.0

# 1. First reference the gearbox-base image.
FROM gearboxworks/gearbox-base:alpine-3.10 as gearbox-base
ARG VERSION

# 2. Set up env variables.
MAINTAINER Gearbox Team <team@gearbox.works>
ENV GEARBOX_CONTAINER_NAME "docker-mailhog"
ENV GEARBOX_CONTAINER_VERSION $VERSION

# 3. Now copy the local files specific to this image.
COPY build /build
COPY ${VERSION}/build /build
COPY ${VERSION}/gearbox.json /build/gearbox.json

# 4. Run the build-base.sh script to set everything up.
RUN /bin/sh /build/build-base.sh

# 5. Run the build-mailhog.sh script to set everything up.
RUN /bin/sh /build/build-mailhog.sh

# 6. Expose ports.
EXPOSE 22 80 25 9970
WORKDIR /project/www

